<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><title>
Ресивер DL</title>
<LINK REL="stylesheet" MEDIA="screen" TYPE="text/css" HREF="../style.css">
<script language="JScript" src="script.js"></script></head>

<body scroll="no">

<DIV id="buttonMenu">
<SPAN CLASS="options">Опции&nbsp;DL:&nbsp;&nbsp;</SPAN>

	<A HREF="#A" title="Изменить параметр элемента диалога" CLASS="button">A</A>
	<SPAN CLASS="buttoninactive">B</SPAN>
	<A HREF="#C" title="Установить реакцию на событие" CLASS="button">C</A>
	<SPAN CLASS="buttoninactive">D</SPAN>
	<A HREF="#E" title="Флаг активности элемента диалога" CLASS="button">E</A>
	 <SPAN CLASS="buttoninactive">F</SPAN>
	<SPAN CLASS="buttoninactive">G</SPAN>
	 <A HREF="#H" title="Настроить подсказку для элемента диалога" CLASS="button">H</A>
	 <SPAN CLASS="buttoninactive">I</SPAN>
 <SPAN CLASS="buttoninactive">J</SPAN>
 <SPAN CLASS="buttoninactive">K</SPAN>
	<SPAN CLASS="buttoninactive">L</SPAN>
	<SPAN CLASS="buttoninactive">M</SPAN>
	<A HREF="#N" title="Анализ шаблона" CLASS="button">N</A>
	<SPAN CLASS="buttoninactive">O</SPAN>
	<A HREF="#P" title="Передать действие функции" CLASS="button">P</A>
 <SPAN CLASS="buttoninactive">Q</SPAN>
 <SPAN CLASS="buttoninactive">R</SPAN>
	<A HREF="#S" title="Показать диалог" CLASS="button">S</A>
 <SPAN CLASS="buttoninactive">T</SPAN>
 <SPAN CLASS="buttoninactive">U</SPAN>
 <SPAN CLASS="buttoninactive">V</SPAN>
 <SPAN CLASS="buttoninactive">W</SPAN>
 <SPAN CLASS="buttoninactive">X</SPAN>
 <SPAN CLASS="buttoninactive">Y</SPAN>
 <SPAN CLASS="buttoninactive">Z</SPAN>
	<A style="position:absolute; right:4" href="#UP" CLASS="button" title="Вернуться к началу">&uarr;</a>

</DIV>

<DIV id="text">
<a name="up"></a>
<p align="center"><font size="5">Ресивер <b>DL</b><img src="../Img/te.gif" class="TE">(нестандартные  диалоги)</font></p>
<p>
<br>
<b><font id="red"><br>
!!DL#:XXXX;</font> 
работа с диалогом # (#&gt;0)<br>
</b>На данный момент (TE) команда &quot;сырая&quot;, <u>полный</u> 
функционал и описание <u>отсутствуют</u>.<br>
См. также: <a href="../Tr/DL.htm">триггер !?DL</a><br>
<br>
<a href="#format">Формат шаблона</a>, <a href="#name">Элементы шаблона</a>.</p>

<hr noshade>
<p><font id="red"><b><a name="A"></a>A#1/#2/#3/1<br></b></font>Изменить параметр элемента диалога<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#1 – номер элемента<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#2 – параметр:<br>
<blockquote id="T0"><div id="step">
<b><u onclick="HideIt(1)" class="h">Подтипы любого элемента управления (<b id="show1">показать</b>)</u></b><div id="1" class="b">
52 – установить положение по X (без перерисовки) (число/числовая переменная)<br>
53 – установить положение по Y (без перерисовки) (число/числовая переменная)<br>
61 – установить ширину (без перерисовки) (число/числовая переменная)</div><br>
<b><u onclick="HideIt(2)" class="h">Подтипы def (<b id="show2">показать</b>)</u></b><div id="2" class="b">
9 – установить имя файла (текстовая переменная)<br>
4 – установить кадр (число/числовая переменная)<br>
12 – установить группу (число/числовая переменная)<br>
8 – установить CloseDialog ?<br>
10 – установить палитру (устройства) ?<br>
13 – установить используемый цвет игрока<br></div><br>
<u><b onclick="HideIt(3)" class="h">Подтипы кнопок (<b id="show3">показать</b>)</b></u><div id="3" class="b">
9 – установить имя файла (текстовая переменная)<br>
10 – установить палитру (устройства) ?<br>
13 – установить используемый цвет игрока<br></div><br>
<u><b onclick="HideIt(4)" class="h">Подтипы pcx (<b id="show4">показать</b>)</b></u><div id="4" class="b">
11 – установить имя файла (текстовая переменная)<br>
10 – установить палитру (устройства) ?<br>
13 – установить используемый цвет игрока<br></div><br>
<u><b onclick="HideIt(5)" class="h">Подтипы прокрутки (<b id="show5">показать</b>)</b></u><div id="5" class="b">
49 – установить позицию (число/числовая переменная)<br>
50 – установить кол-во позиций (число/числовая переменная)<br></div><br>
<u><b onclick="HideIt(6)" class="h">Подтипы поля ввода (<b id="show6">показать</b>)</b></u><div id="6" class="b">
51 – установить максимальную длину (число/числовая переменная)<br>
3 – установить текст (текстовая переменная)<br>
7 – получить текст ?</div></div>
</blockquote>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#3 – значение зависит от #2<br>
Последний элемент команды [1] – обновление (фантомный параметр, который лучше не игнорировать)<br><br>
<i id="bold">Замечание:</i> команда может быть вызвана в триггере <a href="../Tr/DL.htm">!?DL</a>, а также для редактирования диалога &quot;на лету&quot;.<br>
Устанавливает флаг 1 на Истину после своего выполнения.</p>
<hr noshade><p>
<b><font id="red"><a name="C"></a>C#/$2/$3</font></b><br>
Установить особое <a href="#cb" onclick="HideIt(7)">callback</a>-действие ИЛИ изменить курсор мыши.
<pre>        # - тип действия:
	= 1 - закрыть диалог и возвратить данный код в качестве результата
	= (1000 + #) - установить курсор # (см. <a target="form" href="../form/MousePointers.htm#C1">таблицу курсоров</a>)</pre>
<u><b onclick="HideIt(7)" class="h">Комментарий (<b id="show7">показать</b>)</b></u><br><div id="7" class="b">
Для данной команды вам не нужно устанавливать номер диалога в части триггера<a href="../Tr/DL.htm">!?DL</a>. 
Она сработает для активного диалога и на любой объект.<br>
<u>Пример</u>:
<script type="erm">!!DL:C1; - закрыть диалог
!!DL:C1000; - изменить курсор на стрелку (обычный курсор)
!!DL:C1042; - изменить курсор на "затопить корабль"</script></p>
<p>
<a name="cb"></a><b>Callback</b>-действие (или функция в программировании) – это действие, 
которое будет исполнено (вызвано, если речь идёт о функции) по выходу из текущего блока кода (обычно функции).<br>
На примерах <b id="N1">Славы</b> видно, что при каждом событии диалога (таким, как движение мышью) вызывается определённая ЕRМ-функция, 
которая и управляет всей остальной логикой. В функции мы выбираем, на какие действия как реагировать, а что игнорировать. 
Команда <b id="erm"><font class="re">DL</font>:C1</b> была бы обычной функцией, если бы закрывала диалог и тут же выходила из текущего блока кода. 
Но выполнения кода идёт вплоть до конца триггера.</div></p>
<hr noshade><p>
<font id="red"><b>
<a name="E"></a>E#1/#2</b></font><br>
Включить элемент диалога<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #1 – номер элемента<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #2 – включить (1) или выключить (0)<br>
<b><u>Комментарий</u>:</b> при выключении кнопки на элементе будет отображаться следующий кадр в def-источнике.<br>
Устанавливает флаг 1 на Истину после своего выполнения</p>
<hr noshade><p>
<font id="red"><b>
<a name="H"></a>H#1/#2</b></font><br>
Настроить подсказку для элемента диалога<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #1 – номер предмета диалога<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #2 – подсказка (появится при наведении мышью на элемент)<br>
<u><b onclick="HideIt(9)" class="h">Комментарии (<b id="show9">показать</b>)</b></u><br><div id="9" class="b">
Параметр #2 может быть глобальной или статической <i>z</i>-переменной.<br>
Команда устанавливает флаг 1 на Ложь после своего выполнения.<br>
<i id="bold">Замечание:</i> если устанавливать подсказку для элемента, которому уже задана подсказка в текстовом шаблоне диалога - последует вылет игры. Но если в шаблоне подсказка для элемента НЕ задана (пустая строка) - она нормально устанавливается через <b id="erm"><font class="re">!!DL</font>:H&hellip;</b> .</div></p>
<hr noshade> 
<p>
<font id="red"><b>
<a name="N"></a>Nz#<br>
<a name="N"></a>N^текст^</b></font><br>
Анализ шаблона диалога<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# – имя файла шаблона (может быть текстом или любой <i>z</i>-переменной)<br>
<u><b onclick="HideIt(8)" class="h">Комментарии (<b id="show8">показать</b>)</b></u><br><div id="8" class="b">
Текст анализируется перед использованием.<br>
Эта команда загружает файл шаблона (если ещё не загружен), ищет диалог 
(используя Id) в файле и анализирует его.<br>
Она не показывает диалог.<br>
Главная цель этого дать нам шанс настроить загруженный диалог перед его показом.<br>
Результат:<br>
Флаг 1 = 1, если успешно<br>
Флаг 1 = 0, если случились ошибки (не найден шаблон диалога, к примеру)<br>
Формат шаблона описан <a href="#format">ниже</a>.</div></p>
<hr noshade><p>
<font id="red"><b>
<a name="P"></a>P$</b></font><br>
Передать действие функции $<br>
Параметры функции:
<pre>        x1 – действие:
	0 – мышь двигается к другому квадрату
	12 – нажата левая кнопка
	13 – отпущена левая кнопка
	14 – нажата правая кнопка
        x2 – X-координата кликнутого квадрата
        x3 – Y-координата кликнутого квадрата
        x4 – Уровень кликнутого квадрата</pre>
<u>
<b onclick="HideIt(10)" class="h">Пример (<b id="show10">показать</b>)</b></u><div id="10" class="b">
<script type="erm">!?OB8/11/0;
!!DL:P12345;
!!IF:M^Теперь заклинание окончилось.^;
!?FU12345;
!!if&x1=0:;          мышь двигается
  !!OBx2/x3/x4:T?y1; получить тип объекта в квадрате
  !!if&y1=34:;       герой?
    !!DL:C1042;      курсор "Затопить корабль"
  !!el:;
    !!DL:C1000;      курсор-стрелка
  !!en:;
  !!FU:E;
!!en:;
!!if&x1=13:;         левая кнопка отпущена
  !!OBx2/x3/x4:T?y1 C?y2;
  !!if&y1=34:;       герой
    !!HEy2:K;        убить героя
    !!DL:C1000;      курсор-стрелка
  !!en:;
  !!FU:E;
!!en:;
!!if&x1=14:;         нажата левая кнопка
  !!DL:C1;
!!en:;</script>
</div></p>
<hr noshade><p>
<b>
<font id="red">
<a name="S"></a>S$</font><br>

</b>Показать диалог<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $ – получаемый объект (активный объект при закрытии)<br>
Устанавливает флаг 1 на Ложь после своего выполнения<br>
<u><b onclick="HideIt(11)" class="h">Комментарий (<b id="show11">показать</b>)</b></u> <div id="11" class="b">
Показывает диалог (с определённым номером), и ждёт его закрытия. Т.е. дальнейшие команды будут выполнены не сразу, а только после закрытия диалога. Вы можете не использовать параметр вообще, тогда получаемый предмет просто проигнорируется. 
Вы можете показать один диалог &quot;из другого&quot; и последовательность может быть бесконечной, 
но вы можете иметь лишь ОДИН диалог одного типа на экране. Т.е. вы не можете вызвать диалог X из диалога X.</div></p>
<hr noshade>
<h4><a name="form"></a>Формат шаблонов.</h4>
<p>Это стандартный файл текстовой таблицы Героев 3.<br>
Первые две строки пропускаются (могут быть заполнены текстом или оставлены пустыми)<br>
Самый левый столбик также игнорируется (может быть заполнен текстом или оставлен пустым).</p>
<p>В шаблоне должно быть как минимум 14 колонок. Последняя графа в характеристике пункта 
(сразу после &quot;флаг&quot;) это всегда текст подсказки – если текстовый пункт для подсказки присутствует. 
Подсказка требует для себя места даже там, где её не надо. Если графа пуста, то и подсказки как бы нет. 
Если же шаблон &quot;обрезан&quot;, например, до 13 колонок, то для пункта &quot;Text&quot; 
(как самого &quot;длинного&quot;) вместо пустой и &quot;невидимой&quot; подсказки выведится надпись <span id="dl3">&hellip;not 
found the text resourse&hellip;</span>.</p>
<p>Диалог начинается со следующих строк (в порядке столбца):
<blockquote>0: пропускается (можно использовать для внутренних заметок)<br>
1: знак '#' - означает начало нового шаблона диалога<br>
2: xxx номер - уникальный Id диалога<br>
3: номер x позиции - X позиция от верхнего левого угла (-1 = центр экрана)<br>
4: номер y позиции - Y позиция от верхнего левого угла (-1 = центр экрана)<br>
5: dx номер - горизонтальный размер диалога<br>
6: dy номер - вертикальный размер диалога<br>
7: xxx номер - кол-во пунктов диалога (вы можете использовать меньше, но не больше, чем выбрали)<br>
8: xxx номер - установить цвет рамки диалога под цвет номера игрока (-1 = для текущего игрока)<br>
9: текст - имя PCX файла, который будет фоном. 
<b><u onclick="HideIt(20)" class="h">Замечание (<span id="show20">показать</span>)</u></b><div id="20" class="b">
Если не указывать имя PCX файла (оставить поле пустым), то фон будет создан автоматически под указанные размеры диалога 
(стандартный фон игровых диалогов).<br></div><br>
10: XXX номер - Id текстового пункта, который используется как поле с описанием 'hint' 
(для игнорирования укажите пустое значение поля).</blockquote></p>
<p>Следующие строки анализируются как пункты диалога до тех пор, пока не будет знака '#' в первом столбце. 
Это может быть просто пустая строка с '#', или линия с началом нового диалога.</p>

<p><a name="name"></a>Самый главный элемент - первый символ в первом столбце.<br>
Поддерживаемые на данный момент элементы:<br>
<br><u><b onclick="HideIt(12)" class="h">'P' - PCX рисунок (<b id="show12">показать</b>)</b></u><div id="12" class="b">
0: пропускается<br>
1: 'P'&hellip;<br>
2: xxx номер - уникальный Id пункта<br>
3: номер x позиции - X позиция в диалоге от верхнего левого угла<br>
4: номер y позиции - Y позиция в диалоге от верхнего левого угла<br>
5: dx номер - горизонтальный размер пункта<br>
6: dy номер - вертикальный размер пункта<br>
7: текст - имя PCX файла<br>
8: флаги - специфическое значение (ещё не известно полностью)<br>
9: 'hint' - выводимый текст в диалоговом поле описания при наведении курсора на данный элемент диалога</div>
<br>
<u><b onclick="HideIt(13)" class="h">'D' - кадр DEF рисунка (<b id="show13">показать</b>)</b></u><br><div id="13" class="b">
0: пропускается<br>
1: 'D'&hellip;<br>
2: xxx номер - уникальный Id пункта<br>
3: номер x позиции - X позиция в диалоге от верхнего левого угла<br>
4: номер y позиции - Y позиция в диалоге от верхнего левого угла<br>
5: dx номер - горизонтальный размер пункта<br>
6: dy номер - вертикальный размер пункта<br>
7: текст - имя DEF файла<br>
8: кадр - изображения внутри DEF'а для вывода<br>
9: флаги - специфическое значение (ещё не известно полностью)<br>
10: 'hint' - выводимый текст в диалоговом поле описания при наведении курсора на данный элемент диалога</div>
<br>
<b>'A' - анимированный DEF рисунок</b><br>
&nbsp;Ещё не поддерживается<br>
<br>
<u><b onclick="HideIt(14)" class="h">'B' - кнопка (особый DEF) (<b id="show14">показать</b>)</b></u><br><div id="14" class="b">
0: пропускается<br>
1: 'B'&hellip;<br>
2: xxx номер - уникальный Id пункта<br>
3: номер x позиции - X позиция в диалоге от верхнего левого угла<br>
4: номер y позиции - Y позиция в диалоге от верхнего левого угла<br>
5: dx номер - горизонтальный размер пункта<br>
6: dy номер - вертикальный размер пункта<br>
7: текст - имя DEF файла<br>
8: флаги - специфическое значение (ещё не известно полностью)<br>
9: 'hint' - выводимый текст в диалоговом поле описания при наведении курсора на данный элемент диалога
<br>
<p id="Q1"><i id="bold">Замечание</i>: в DEF'е кнопки должно быть как минимум 2 кадра. При нажатии на 
кнопку показывается второй кадр. Также при отключении кнопки (переводе элемента 
диалога в режим выключен) показывается второй кадр. Например, если вы сделаете 
кнопкой DEF с заклинаниями, то будет изображено заклинания "Вызов лодки", а при 
нажатии или выключении вы увидите следующее заклинание - "Затопить лодку".<br>
При нажатии на кнопку (не удерживая) происходит выход из диалога (выход в предыдущий диалог, 
если диалог был открыт из другого диалога, и, конечно, кнопка должна быть включена).</p>
<p><u>Совет</u> от <b id="N1">Master</b>'а: кнопкам всегда лучше давать отрицательные идентификаторы (-32768 ... -1). 
Это гарантированно исключит совпадения и конфликты с прочими элементами геройских окон (других кнопок, надписей, картинок, DEF'ов и пр.), 
многие из которых незадокументированы в ERM-справке. -ID работают совершенно нормально, но в геройском коде никогда не встречаются.</p></div>
<br>
<u><b onclick="HideIt(15)" class="h">'T' - текст (<b id="show15">показать</b>)</b></u><br><div id="15" class="b">
0: пропускается<br>
1: 'T'&hellip;<br>
2: xxx номер - уникальный Id пункта<br>
3: номер x позиции - X позиция в диалоге от верхнего левого угла<br>
4: номер y позиции - Y позиция в диалоге от верхнего левого угла<br>
5: dx номер - горизонтальный размер пункта<br>
6: dy номер - вертикальный размер пункта<br>
7: текст - текст (может быть пустым и заполняться позже)<br>
8: шрифт - имя файла шрифта<br>
9: цвет - цвет текста<br>
10: bkcol - <u>
<b onclick="HideIt(25)" class="h">цвета фона (<b id="show25">показать</b>)</b></u><br><div id="25" class="b">
 <img src="../Img/bgcolor.png"><br></div>
11: выравнивание - выравнивание текста (0 = по левому краю; 1 = по центру; 2 = по правому краю)<br>
12: флаги - специфическое значение (ещё не известно полностью)<br>
13: 'hint' - выводимый текст в диалоговом поле описания при наведении курсора на данный элемент диалога</div>
<br>
<u><b onclick="HideIt(16)" class="h">'S' - текст с вертикальной прокруткой (<b id="show16">показать</b>)</b></u><br><div id="16" class="b">
0: пропускается<br>
1: 'S'&hellip;<br>
2: xxx номер - уникальный Id пункта<br>
3: номер x позиции - X позиция в диалоге от верхнего левого угла<br>
4: номер y позиции - Y позиция в диалоге от верхнего левого угла<br>
5: dx номер - горизонтальный размер пункта<br>
6: dy номер - вертикальный размер пункта<br>
7: текст - текст (может быть пустым и заполняться позже)<br>
8: шрифт - имя файла шрифта<br>
9: цвет - цвет текста<br>
10: цвет2 - цвет полосы прокрутки (0 = не окрашивать; любое другое значение = окрасить синим)<br>
11: 'hint' - выводимый текст в диалоговом поле описания при наведении курсора на данный элемент диалога (работает только, если элемент прокрутки имеет id=-1)<br></div>
<br>
<u><b onclick="HideIt(17)" class="h">'E' - отредактированный текст (<b id="show17">показать</b>)</b></u><br><div id="17" class="b">
0: пропускается<br>
1: 'E'&hellip;<br>
2: xxx номер - уникальный Id пункта<br>
3: номер x позиции - X позиция в диалоге от верхнего левого угла<br>
4: номер y позиции - Y позиция в диалоге от верхнего левого угла<br>
5: dx номер - горизонтальный размер пункта<br>
6: dy номер - вертикальный размер пункта<br>
7: текст - текст (может быть пустым и заполняться позже)<br>
8: шрифт - имя файла шрифта<br>
9: 'hint' - выводимый текст в диалоговом поле описания при наведении курсора на данный элемент диалога</div>
<br>
<u><b onclick="HideIt(18)" class="h">'V' - SMK или BIK видео (<b id="show18">показать</b>)</b></u><br><div id="18" class="b">
0: пропускается<br>
1: 'V'&hellip;<br>
2: xxx номер - уникальный Id пункта<br>
3: номер x позиции - X позиция в диалоге от верхнего левого угла<br>
4: номер y позиции - Y позиция в диалоге от верхнего левого угла<br>
5: номер видео - внутренний номер <a target="form" href="../form/Video.htm">игрового видео</a><br>
Видео выводится поверх любых других пунктов диалога и не имеет поддержки 'hint' описания. 
Это значит, что вам нужно следить, чтобы видео не вылазило за границы окна диалога, 
чтобы не получить проблем с перерисовкой.<br>
Также вы можете использовать только одно видео за диалог.<br></div>
<br>
<i>Примечания:</i><br>
Вы можете хранить больше одного диалога в файле шаблона.<br>
Вы не должны использовать одинаковые Id диалогов в различных файлах шаблонов. 
Каждый диалог должен иметь свой унильный Id. Это также значит, что некоторые Id будут заняты под WoG-диалоги.<br>
Пункт с номером 30721 - пункт отмены по умолчанию. Так, если игрок нажимает кнопку <span class="key">ESC</span> когда выведен диалог - диалог закроется.</p>

<p><u><b onclick="HideIt(19)" class="h">Цвета текста (<b id="show19">показать</b>)</b></u><div id="19" class="b">
<i>Белый: 1,4,11,17,18,30 <br>
Жёлтый: 3,6,9,20,29<br>
Светло-жёлтый: 2,5,7,8,10,12,19,21,22<br>
Зелёный: -10,-4,13,15,25<br>
Светло-зелёный: -6,14,<br>
Желтовато-белый: 16<br>
Чёрный: -27,-9,-7,-5,-3,-1,23<br>
Синий: 24<br>
Голубой: -8,26<br>
Красный: 27<br>
Фиолетовый: 28<br>
Тёмно-красный: -2<br>
Голубовато-белый: 0</i></div></p>
<p>&nbsp;</p>
</DIV>
<script src="../erm.js"></script></body></html>